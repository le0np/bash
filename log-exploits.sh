#!/bin/bash

# Directory to scan
scan_directory="/home"

# Command to run for checking potential exploits
check_command="grep -E 'union\s+select|eval\(|base64_decode|wget|curl'"

# Loop through directories in the scan directory
for directory in "$scan_directory"/*/; do
    user_directory="${directory%/}"

    # Check if logs directory exists
    logs_directory="$user_directory/logs"
    if [ -d "$logs_directory" ]; then
        access_log="$logs_directory/access_log"
        if [ -f "$access_log" ]; then
            echo "Scanning $access_log"

            # Run the command and save output to potential_exploits.txt
            $check_command "$access_log" > "$logs_directory/potential_exploits.txt"
        fi
    fi
done
